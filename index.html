<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Servi√ßo+ ‚Äî Guia colaborativo de servi√ßos locais (v3)</title>
  <style>
    :root{--accent:#007bff;--muted:#6b7280;--bg:#f7fafc}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:#0f1724}
    header{background:linear-gradient(90deg,#0366d6,#0056b3);color:#fff;padding:18px 16px;display:flex;align-items:center;gap:12px}
    header h1{font-size:18px;margin:0}
    .container{max-width:980px;margin:20px auto;padding:16px}
    .search-row{display:flex;gap:8px;margin-bottom:12px}
    .search-row input{flex:1;padding:12px;border-radius:10px;border:1px solid #e5e7eb}
    .btn{background:var(--accent);color:#fff;padding:10px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:600}
    .btn.ghost{background:transparent;border:1px solid #e5e7eb;color:var(--muted);font-weight:600}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:12px}
    .card{background:#fff;padding:12px;border-radius:10px;border:1px solid #e6ecf2}
    .meta{font-size:13px;color:var(--muted);margin-bottom:8px}
    .actions{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    .pill{display:inline-block;padding:6px 8px;border-radius:999px;background:#f1f5f9;font-size:13px;color:var(--muted)}
    .notice{color:var(--muted);padding:8px 0}
    footer{text-align:center;color:var(--muted);padding:16px}
    /* modal simple */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.45);padding:16px}
    .modal.show{display:flex}
    .modal-card{width:100%;max-width:720px;background:#fff;border-radius:12px;padding:16px;border:1px solid #e6ecf2}
    label{display:block;font-size:13px;color:#374151;margin-top:8px}
    input[type=text], textarea, select{width:100%;padding:10px;border-radius:8px;border:1px solid #e5e7eb;margin-top:6px}
    textarea{min-height:90px}
    @media(max-width:640px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
<header>
  <h1>Servi√ßo+</h1>
</header>

<main class="container">
  <div class="search-row">
    <input id="q" placeholder="Pesquisar por nome, categoria ou localiza√ß√£o...">
    <button class="btn" id="searchBtn">Pesquisar</button>
    <button class="btn ghost" id="addBtn">‚ûï Adicionar</button>
  </div>

  <div class="actions">
    <button class="btn ghost" id="catsBtn">üìÇ Ver Categorias</button>
    <button class="btn ghost" id="clearBtn">üßπ Limpar</button>
    <button class="btn ghost" id="testBtn">üîå Testar API</button>
  </div>

  <div id="resultsArea" class="grid" aria-live="polite"></div>
  <div id="emptyNotice" class="notice" style="display:none">Nenhum resultado. Tente outra busca ou adicione um servi√ßo.</div>
</main>

<footer>Servi√ßo+ ‚Ä¢ Vers√£o 3 ‚Äî feito com ferramentas gr√°tis</footer>

<!-- Modal -->
<div id="modal" class="modal" role="dialog" aria-hidden="true">
  <div class="modal-card">
    <h2>Adicionar Empresa</h2>
    <p style="margin:6px 0 12px;color:#374151">Preencha os dados e clique em Enviar. Campos com * s√£o obrigat√≥rios.</p>

    <label>Nome *</label>
    <input type="text" id="nome">

    <label>Categoria *</label>
    <input type="text" id="categoria" placeholder="ex: √ìptica, Farm√°cia, Restaurante">

    <label>Localiza√ß√£o</label>
    <input type="text" id="localizacao" placeholder="Bairro, Rua, Cidade">

    <label>Contacto *</label>
    <input type="text" id="contacto" placeholder="ex: 84xxxxxxx">

    <label>WhatsApp</label>
    <input type="text" id="whatsapp" placeholder="apenas n√∫meros">

    <label>Descri√ß√£o</label>
    <textarea id="descricao" placeholder="Breve descri√ß√£o ou servi√ßos oferecidos"></textarea>

    <label>Foto_URL (opcional)</label>
    <input type="text" id="foto_url" placeholder="URL da imagem">

    <div style="display:flex;gap:8px;margin-top:12px">
      <button class="btn" id="submitBtn">Enviar</button>
      <button class="btn ghost" id="cancelBtn">Cancelar</button>
    </div>

    <p id="formMsg" class="notice" style="display:none"></p>
  </div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzUbQjLPe5BEswd9iBIBUH4rPBX0yn5kzFfeVK4OAg-JH84Y-YqL-YbeTJj4FrFQFKd/exec";
function esc(s){ if(!s) return ''; return String(s).replace(/[&<>"']/g, function(m){return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m];}); }
async function fetchAll(){ try{ const r = await fetch(API_URL); if(!r.ok) throw new Error('HTTP '+r.status); const data = await r.json(); return data || []; }catch(e){ console.error('fetchAll error',e); return null; } }
async function searchAndRender(){ const q = document.getElementById('q').value.trim().toLowerCase(); const resultsArea = document.getElementById('resultsArea'); resultsArea.innerHTML = ''; document.getElementById('emptyNotice').style.display='none'; if(!q){ document.getElementById('emptyNotice').textContent='Digite algo para pesquisar.'; document.getElementById('emptyNotice').style.display='block'; return; } const all = await fetchAll(); if(all === null){ resultsArea.innerHTML = '<div class="card">Erro ao conectar com a API. Verifique a configura√ß√£o.</div>'; return; } const filtered = all.filter(item=>{ return (item.Nome||'').toString().toLowerCase().includes(q) || (item.Categoria||'').toString().toLowerCase().includes(q) || (item['Localiza√ß√£o']||'').toString().toLowerCase().includes(q); }); if(filtered.length === 0){ document.getElementById('emptyNotice').textContent='Nenhum resultado encontrado.'; document.getElementById('emptyNotice').style.display='block'; return; } resultsArea.innerHTML = filtered.map(s=>`<div class="card"><h3>${esc(s.Nome)}</h3><div class="meta">${esc(s.Categoria)} ¬∑ ${esc(s['Localiza√ß√£o'])}</div><div style="margin:8px 0">${esc(s.Descri√ß√£o || '')}</div><div style="display:flex;gap:8px;flex-wrap:wrap"><a class="pill" href="tel:${esc(s.Contacto||'')}" onclick="event.stopPropagation()">Ligar</a><a class="pill" href="https://wa.me/${esc(s.WhatsApp||'')}" target="_blank" onclick="event.stopPropagation()">WhatsApp</a>${'{img}'} </div></div>`).join(''); }
const modal = document.getElementById('modal'); document.getElementById('addBtn').addEventListener('click', ()=>{ modal.classList.add('show'); modal.setAttribute('aria-hidden','false'); }); document.getElementById('cancelBtn').addEventListener('click', ()=>{ modal.classList.remove('show'); modal.setAttribute('aria-hidden','true'); document.getElementById('formMsg').style.display='none'; }); document.getElementById('submitBtn').addEventListener('click', async ()=>{ const nome = document.getElementById('nome').value.trim(); const categoria = document.getElementById('categoria').value.trim(); const localizacao = document.getElementById('localizacao').value.trim(); const contacto = document.getElementById('contacto').value.trim(); const whatsapp = document.getElementById('whatsapp').value.trim(); const descricao = document.getElementById('descricao').value.trim(); const foto_url = document.getElementById('foto_url').value.trim(); const msg = document.getElementById('formMsg'); if(!nome || !contacto){ msg.style.display='block'; msg.textContent='Por favor preencha Nome e Contacto.'; return; } msg.style.display='block'; msg.textContent='Enviando...'; const payload = { nome: nome, categoria: categoria, localizacao: localizacao, contacto: contacto, descricao: descricao, whatsapp: whatsapp, foto_url: foto_url }; try{ const r = await fetch(API_URL, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) }); if(!r.ok) throw new Error('HTTP '+r.status); const j = await r.json(); msg.textContent='Enviado! ID: '+(j.id||'ok'); setTimeout(()=>{ modal.classList.remove('show'); msg.style.display='none'; },1000); }catch(e){ console.error('submit error',e); msg.innerHTML='Falha ao enviar. Tente novamente ou envie via WhatsApp.'; const waMsg = encodeURIComponent(`Quero submeter: Nome:${nome} Categoria:${categoria} Local:${localizacao} Tel:${contacto} WhatsApp:${whatsapp} Desc:${descricao}`); const waLink = 'https://wa.me/258848888888?text='+waMsg; setTimeout(()=>{ if(confirm('Enviar via WhatsApp?')) window.open(waLink,'_blank'); },200); } }); document.getElementById('searchBtn').addEventListener('click', searchAndRender); document.getElementById('q').addEventListener('keydown', function(e){ if(e.key==='Enter') searchAndRender(); }); document.getElementById('clearBtn').addEventListener('click', ()=>{ document.getElementById('resultsArea').innerHTML=''; document.getElementById('q').value=''; document.getElementById('emptyNotice').style.display='none'; }); document.getElementById('catsBtn').addEventListener('click', async ()=>{ const all = await fetchAll(); if(all === null){ document.getElementById('resultsArea').innerHTML='<div class="card">Erro ao conectar API.</div>'; return; } const cats = [...new Set(all.map(x=>x.Categoria||'Outros'))]; document.getElementById('resultsArea').innerHTML = cats.map(c=>`<div class="card"><strong>${esc(c)}</strong></div>`).join(''); }); document.getElementById('testBtn').addEventListener('click', async ()=>{ try{ const r = await fetch(API_URL); if(r.ok) alert('API conectada com sucesso!'); else alert('API retornou status '+r.status); }catch(e){ alert('Erro ao conectar com API'); } }); </script></body></html>