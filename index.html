<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Serviço+ — Guia de Serviços Locais</title>
  <link rel="icon" href="logo.png" />
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --accent:#00a3ff;
      --muted:#94a3b8;
      --glass: rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:linear-gradient(180deg,#071020 0%, #0b1522 100%);
      color:#e6eef8;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      min-height:100vh;
    }
    header{
      display:flex;
      gap:12px;
      align-items:center;
      padding:18px 20px;
      border-bottom:1px solid rgba(255,255,255,0.03);
      background: linear-gradient(90deg, rgba(0,0,0,0.25), transparent);
    }
    header img{width:44px;height:44px;border-radius:8px;object-fit:cover}
    header h1{font-size:18px;margin:0}
    .wrap{max-width:980px;margin:28px auto;padding:0 16px}
    .searchbar{
      display:flex;
      gap:10px;
      align-items:center;
      margin-bottom:18px;
    }
    .search{
      flex:1;
      display:flex;
      background:var(--card);
      border-radius:12px;
      padding:12px;
      gap:10px;
      border:1px solid rgba(255,255,255,0.03);
    }
    .search input{
      background:transparent;border:0;outline:none;color:inherit;font-size:15px;width:100%;
    }
    .btn{
      background:var(--accent);color:#05202b;border:0;padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer;
      box-shadow:0 6px 18px rgba(0,163,255,0.12);
    }
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);font-weight:600}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px}
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);
    }
    .card h3{margin:0 0 8px 0;color:var(--accent);font-size:16px}
    .meta{font-size:13px;color:var(--muted);margin-bottom:8px}
    .actions{display:flex;gap:8px;margin-top:10px}
    .pill{display:inline-block;padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.02);font-size:12px;color:var(--muted)}
    footer{max-width:980px;margin:26px auto;padding:16px;color:var(--muted);text-align:center}
    /* modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:20px;background:linear-gradient(180deg, rgba(2,6,23,0.6), rgba(2,6,23,0.85))}
    .modal.show{display:flex}
    .modal-card{width:100%;max-width:720px;background:linear-gradient(180deg,#071427, #061527);border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.04)}
    label{display:block;font-size:13px;color:var(--muted);margin-top:10px}
    input[type=text], select, textarea{width:100%;padding:10px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit;margin-top:6px}
    textarea{min-height:90px;resize:vertical}
    .row{display:flex;gap:10px}
    @media(max-width:640px){header h1{font-size:16px}.row{flex-direction:column}}
    .notice{margin-top:10px;font-size:13px;color:#9ad3ff}
    .small{font-size:13px;color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Serviço+ logo">
    <div>
      <h1>Serviço+ <span class="small">Guia colaborativo de serviços locais</span></h1>
    </div>
  </header>

  <main class="wrap">
    <div class="searchbar">
      <div class="search">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" style="opacity:0.8"><path d="M21 21l-4.35-4.35" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><circle cx="11" cy="11" r="6" stroke="white" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <input id="q" placeholder="Pesquisar lojas, serviços ou bairro..." />
      </div>
      <button class="btn" id="addBtn">Adicionar Serviço</button>
    </div>

    <div id="results" class="grid" aria-live="polite"></div>

    <div id="empty" class="notice" style="display:none">Nenhum resultado. Tenta outra palavra — ou adiciona um novo serviço.</div>
  </main>

  <footer>Serviço+ • Base de dados colaborativa — feito com ferramentas grátis</footer>

  <!-- Modal -->
  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-card">
      <h2>Adicionar novo serviço</h2>
      <p class="small">Preencha os dados. A submissão será enviada para a tua folha Google (via Apps Script).</p>

      <label>Nome do local<input type="text" id="nome"></label>
      <div class="row">
        <label style="flex:1">Categoria
          <select id="categoria">
            <option>Óptica</option>
            <option>Farmácia</option>
            <option>Restaurante</option>
            <option>Oficina</option>
            <option>Serviços</option>
            <option>Outro</option>
          </select>
        </label>
        <label style="flex:1">Telefone<input type="text" id="telefone" placeholder="ex: 84xxxxxxx"></label>
      </div>
      <label>WhatsApp (apenas números)<input type="text" id="whatsapp" placeholder="848888888"></label>
      <label>Bairro / Endereço<input type="text" id="bairro" placeholder="Nacala Porto, Cidade..."></label>
      <label>Horário / Observações<textarea id="obs" placeholder="Ex: 08:00–17:00"></textarea></label>

      <div style="display:flex;gap:8px;margin-top:12px">
        <button class="btn" id="submitBtn">Enviar</button>
        <button class="btn ghost" id="cancelBtn">Cancelar</button>
      </div>

      <p id="formMsg" class="notice" style="display:none"></p>
    </div>
  </div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbz2zbZOT7MjP2BRusUq_7IpwcSyITQEO5dN7EGLnnk6qHbIwnLj9yWv6ojDKgrPnq0/exec";
const SUBMIT_URL = API_URL; // apps script should implement doPost to accept submissions

async function fetchServices(){
  try{
    const res = await fetch(API_URL);
    if(!res.ok) throw new Error('Erro ao buscar');
    const data = await res.json();
    window.services = data;
    renderList(data);
  }catch(e){
    console.error(e);
    document.getElementById('results').innerHTML = '<div class="notice">Não foi possível carregar serviços. Verifica a tua API.</div>';
  }
}

function renderList(list){
  const container = document.getElementById('results');
  container.innerHTML = '';
  if(!list || list.length===0){ document.getElementById('empty').style.display='block'; return;}
  document.getElementById('empty').style.display='none';
  list.forEach(s=>{
    const el = document.createElement('div');
    el.className='card';
    const nome = s.Nome || s.name || 'Sem nome';
    const cat = s.Categoria || s.categoria || '';
    const bairro = s.Bairro || s.bairro || '';
    const telefone = s.Telefone || s.telefone || '';
    const whatsapp = s.WhatsApp || s.whatsapp || '';
    const horario = s.Horario || s.horario || '';
    const desc = s.Descrição || s.descricao || '';

    el.innerHTML = `<h3>${escapeHtml(nome)}</h3>
      <div class="meta">${escapeHtml(cat)} · ${escapeHtml(bairro)}</div>
      <div class="small">${escapeHtml(desc)}</div>
      <div class="actions">
        <a class="pill" href="tel:${telefone}">Ligar</a>
        <a class="pill" href="https://wa.me/${whatsapp}" target="_blank">WhatsApp</a>
        <span class="pill">${escapeHtml(horario)}</span>
      </div>`;
    container.appendChild(el);
  });
}

function escapeHtml(str){ if(!str) return ''; return String(str).replace(/[&<>"']/g, function(m){return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m];}); }

// Search
document.getElementById('q').addEventListener('input', function(){
  const v = this.value.trim().toLowerCase();
  if(!v){ renderList(window.services || []); return; }
  const filtered = (window.services||[]).filter(s=>{
    return (s.Nome||'').toLowerCase().includes(v) ||
           (s.Categoria||'').toLowerCase().includes(v) ||
           (s.Bairro||'').toLowerCase().includes(v) ||
           (s.Descrição||'').toLowerCase().includes(v);
  });
  renderList(filtered);
});

// Modal controls
const modal = document.getElementById('modal');
document.getElementById('addBtn').addEventListener('click', ()=>{ modal.classList.add('show'); modal.setAttribute('aria-hidden','false');});
document.getElementById('cancelBtn').addEventListener('click', ()=>{ modal.classList.remove('show'); modal.setAttribute('aria-hidden','true'); });

// Form submit
document.getElementById('submitBtn').addEventListener('click', async ()=>{
  const nome = document.getElementById('nome').value.trim();
  const categoria = document.getElementById('categoria').value.trim();
  const telefone = document.getElementById('telefone').value.trim();
  const whatsapp = document.getElementById('whatsapp').value.trim();
  const bairro = document.getElementById('bairro').value.trim();
  const obs = document.getElementById('obs').value.trim();
  const msgEl = document.getElementById('formMsg');
  if(!nome || !telefone){ msgEl.style.display='block'; msgEl.textContent='Por favor preencha pelo menos o nome e telefone.'; return; }
  msgEl.style.display='block'; msgEl.textContent='Enviando...';

  const payload = {
    Nome: nome,
    Categoria: categoria,
    Telefone: telefone,
    WhatsApp: whatsapp,
    Bairro: bairro,
    Horario: obs
  };

  try{
    const res = await fetch(SUBMIT_URL, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    if(res.ok){
      msgEl.textContent='Obrigado! Submissão recebida.';
      setTimeout(()=>{ modal.classList.remove('show'); msgEl.style.display='none'; },1200);
      // refresh list
      setTimeout(fetchServices,1200);
    } else {
      const text = await res.text();
      throw new Error('Resposta não-ok: '+text);
    }
  }catch(err){
    console.error(err);
    msgEl.innerHTML='Falha ao enviar diretamente. <br>Abre o WhatsApp para enviar?';
    // fallback: open WhatsApp with prefilled message
    const waMsg = encodeURIComponent(`Olá, quero submeter um serviço:\nNome: ${nome}\nCategoria: ${categoria}\nTel: ${telefone}\nWhatsApp: ${whatsapp}\nBairro: ${bairro}\nObs: ${obs}`);
    const waUrl = 'https://wa.me/258848888888?text='+waMsg; // replace with your contact
    setTimeout(()=>{ if(confirm('Enviar via WhatsApp?')) window.open(waUrl,'_blank'); },200);
  }
});

fetchServices();
</script>
</body>
</html>
